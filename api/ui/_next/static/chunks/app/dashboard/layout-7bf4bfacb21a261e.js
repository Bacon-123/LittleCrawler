(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{3166:function(t,e,o){Promise.resolve().then(o.bind(o,7123))},7123:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return l}});var n=o(7437),a=o(2265),r=o(9376),i=o(4362),c=o(4555);function l(t){let{children:e}=t,o=(0,r.useRouter)(),{isAuthenticated:l,isLoading:u}=(0,i.a)();return((0,a.useEffect)(()=>{u||l||o.replace("/login")},[l,u,o]),u)?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:(0,n.jsx)(c.c,{size:"lg",color:"secondary"})}):l?(0,n.jsx)(n.Fragment,{children:e}):null}},4362:function(t,e,o){"use strict";o.d(e,{H:function(){return c},a:function(){return l}});var n=o(7437),a=o(2265),r=o(1837);let i=(0,a.createContext)(void 0);function c(t){let{children:e}=t,[o,c]=(0,a.useState)(null),[l,u]=(0,a.useState)(null),[s,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let t=localStorage.getItem("token");t?(u(t),r.iJ.getCurrentUser(t).then(t=>{c(t)}).catch(()=>{localStorage.removeItem("token"),u(null)}).finally(()=>{d(!1)})):d(!1)},[]);let h=async t=>{let e=await r.iJ.login(t);u(e.access_token),c(e.user),localStorage.setItem("token",e.access_token)};return(0,n.jsx)(i.Provider,{value:{user:o,token:l,isAuthenticated:!!l&&!!o,isLoading:s,login:h,logout:()=>{l&&r.iJ.logout(l).catch(console.error),u(null),c(null),localStorage.removeItem("token")}},children:e})}function l(){let t=(0,a.useContext)(i);if(!t)throw Error("useAuth must be used within AuthProvider");return t}},1837:function(t,e,o){"use strict";o.d(e,{BQ:function(){return a},Bl:function(){return l},Z9:function(){return c},iJ:function(){return i},oD:function(){return u}});let n=()=>window.location.origin,a=()=>{{let t="https:"===window.location.protocol?"wss:":"ws:";return"".concat(t,"//").concat(window.location.host)}};async function r(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,a={"Content-Type":"application/json",...e.headers};o&&(a.Authorization="Bearer ".concat(o));let r=await fetch("".concat(n()).concat(t),{...e,headers:a});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Unknown error"}))).detail||"HTTP ".concat(r.status));return r.json()}let i={login:t=>r("/api/auth/login",{method:"POST",body:JSON.stringify(t)}),getCurrentUser:t=>r("/api/auth/me",{},t),logout:t=>r("/api/auth/logout",{method:"POST"},t)},c={getStatus:t=>r("/api/crawler/status",{},t),start:(t,e)=>r("/api/crawler/start",{method:"POST",body:JSON.stringify(e)},t),stop:t=>r("/api/crawler/stop",{method:"POST"},t),getPlatforms:t=>r("/api/crawler/platforms",{},t)},l={getFiles:(t,e,o)=>{let n=new URLSearchParams;e&&n.append("platform",e),o&&n.append("file_type",o);let a=n.toString();return r("/api/data/files".concat(a?"?".concat(a):""),{},t)},getFileContent:function(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return r("/api/data/files/".concat(encodeURIComponent(e),"?preview=true&limit=").concat(o),{},t)},export:(t,e,o)=>fetch("".concat(n(),"/api/data/").concat(e,"/export?format=").concat(o),{headers:{Authorization:"Bearer ".concat(t)}}).then(t=>t.blob()),delete:(t,e,o)=>r("/api/data/".concat(e,"/").concat(o),{method:"DELETE"},t)},u={getStatus:t=>r("/api/publisher/status",{},t),searchTopic:function(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return r("/api/publisher/topic/search",{method:"POST",body:JSON.stringify({keyword:e,page:o,page_size:20})},t)},uploadImage:async(t,e)=>{let o=new FormData;o.append("file",e);let a=await fetch("".concat(n(),"/api/publisher/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:o});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Upload failed"}))).detail||"HTTP ".concat(a.status));return a.json()},deleteImage:(t,e)=>r("/api/publisher/upload/".concat(encodeURIComponent(e)),{method:"DELETE"},t),publishNote:(t,e)=>r("/api/publisher/publish",{method:"POST",body:JSON.stringify(e)},t)}}},function(t){t.O(0,[69,971,117,744],function(){return t(t.s=3166)}),_N_E=t.O()}]);